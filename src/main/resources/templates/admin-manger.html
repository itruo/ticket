<!doctype html>
<html class="no-js" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <title>管理员管理</title>
  <meta name="description" content="这是一个log页面"/>
  <meta name="keywords" content="log"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="renderer" content="webkit"/>
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="icon" type="image/png" href="../static/assets/i/favicon.png"/>
  <link rel="apple-touch-icon-precomposed" href="../static/assets/i/app-icon72x72@2x.png"/>
  <meta name="apple-mobile-web-app-title" content="Amaze UI" />
  <link rel="stylesheet" href="../static/assets/css/amazeui.min.css"/>
  <link rel="stylesheet" href="../static/assets/css/admin.css"/>
  <link rel="stylesheet" href="../static/assets/css/amazeui.datatables.min.css" />
  <link rel="stylesheet" href="../static/js/layer/skin/default/layer.css" />
</head>
<body>

<!--[if lte IE 9]>
<p class="browsehappy">你正在使用<strong>过时</strong>的浏览器，Amaze UI 暂不支持。 请 <a href="http://browsehappy.com/" target="_blank">升级浏览器</a>
  以获得更好的体验！</p>
<![endif]-->

<header class="am-topbar am-topbar-inverse admin-header">
  <div class="am-topbar-brand">
    <strong>文化票号</strong> <small>后台管理系统</small>
  </div>

  <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span></button>

  <div class="am-collapse am-topbar-collapse" id="topbar-collapse">

    <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list">
      <li><a href="javascript:;"><span class="am-icon-envelope-o"></span> 收件箱 <span class="am-badge am-badge-warning">5</span></a></li>
      <li class="am-dropdown" data-am-dropdown="data-am-dropdown">
        <a class="am-dropdown-toggle" data-am-dropdown-toggle="data-am-dropdown-toggle" href="javascript:;">
          <span class="am-icon-users"></span> <b th:text="${session.username}">管理员</b> <span class="am-icon-caret-down"></span>
            <input type="hidden" id="admin_role_hidden" th:value="${session.role}" />
        </a>
        <ul class="am-dropdown-content">
          <li><a href="#"><span class="am-icon-user"></span> 资料</a></li>
          <li><a href="#"><span class="am-icon-cog"></span> 设置</a></li>
          <li><a href="/admin/exit"><span class="am-icon-power-off"></span> 退出</a></li>
        </ul>
      </li>
      <li class="am-hide-sm-only"><a href="javascript:;" id="admin-fullscreen"><span class="am-icon-arrows-alt"></span> <span class="admin-fullText">开启全屏</span></a></li>
    </ul>
  </div>
</header>

<div class="am-cf admin-main">
  <!-- sidebar start -->
  <div class="admin-sidebar am-offcanvas" id="admin-offcanvas">
    <div class="am-offcanvas-bar admin-offcanvas-bar">
      <ul class="am-list admin-sidebar-list" id="collapase-nav-1">
        <li><a href="/admin/index"><span class="am-icon-home"></span> 首页</a></li>

          <li class="admin-parent">
              <a class="am-cf" data-am-collapse="{target: '#collapse-nav'}"><span class="am-icon-user-md"></span>管理员管理 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
              <ul class="am-list am-collapse admin-sidebar-sub am-in" id="collapse-nav">
                  <li><a href="/admin/adminmanger"><span class="am-icon-user-md"></span> 账号信息管理</a></li>
                  <li><a href="/admin/role"><span class="am-icon-user-md"></span> 角色信息管理</a></li>
                  <li><a href="/admin/opt"><span class="am-icon-dashboard"></span> 操作权限管理</a></li>
              </ul>
          </li>
          <li class="admin-parent">
              <a class="am-cf" data-am-collapse="{target: '#collapse-nav1'}"><span class="am-icon-users"></span>用户管理 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
              <ul class="am-list am-collapse admin-sidebar-sub am-in" id="collapse-nav1">
                  <li><a href="/usermanger/userinfo"><span class="am-icon-user"></span> 账号信息管理</a></li>
                  <li><a href="/usermanger/detailinfo"><span class="am-icon-user"></span> 详细信息管理</a></li>
                  <li><a href="/usermanger/firminfo"><span class="am-icon-empire"></span> 公司信息管理</a></li>
              </ul>
          </li>
          <li class="admin-parent">
              <a class="am-cf" data-am-collapse="{target: '#collapse-nav2'}"><span class="am-icon-windows"></span> 系统管理 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
              <ul class="am-list am-collapse admin-sidebar-sub am-in" id="collapse-nav2">
                  <li><a href="admin-help.html"><span class="am-icon-puzzle-piece"></span> 帮助页</a></li>
                  <li><a href="admin-log.html"><span class="am-icon-calendar"></span> 系统日志</a></li>
                  <li><a href="admin-404.html"><span class="am-icon-bug"></span> 404</a></li>
              </ul>
          </li>
          <li><a href="admin-user.html"><span class="am-icon-check"></span>  个人资料<span class="am-icon-star am-fr am-margin-right admin-icon-yellow"></span></a></li>
          <li><a href="admin-form.html"><span class="am-icon-pencil-square-o"></span> 表单</a></li>
          <li><a href="/admin/exit"><span class="am-icon-sign-out"></span> 注销</a></li>
      </ul>

      <div class="am-panel am-panel-default admin-sidebar-panel">
        <div class="am-panel-bd">
          <p><span class="am-icon-bookmark"></span> 公告</p>
          <p>时光静好，与君语；细水流年，与君同。—— Amaze UI</p>
        </div>
      </div>

      <div class="am-panel am-panel-default admin-sidebar-panel">
        <div class="am-panel-bd">
          <p><span class="am-icon-tag"></span> wiki</p>
          <p>Welcome to Cultural Exchange Shop!</p>
        </div>
      </div>
    </div>
  </div>
  <!-- sidebar end -->

  <!-- content start -->
  <div class="admin-content">
    <div class="admin-content-body">
      <div class="am-cf am-padding am-padding-bottom-0">
        <div class="am-fl"><strong class="am-text-primary am-text-lg">管理员管理</strong> / <small>账号信息管理</small></div>
      </div>

      <hr/>

      <div class="am-g error-log">
        <div class="am-u-sm-12 am-u-sm-centered">
        	<table class="am-table am-table-striped am-table-bordered am-table-compact" id="example">
                <thead style="font-size: small">
                <tr>
                    <th>ID</th>
                    <th>用户名</th>
                    <th>密码</th>
                    <th>角色</th>
                    <th>添加时间</th>
                    <th>更新时间</th>
                    <th>是否可用</th>
                    <th>添加人</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                    <tr class="odd gradeX" style="font-size: 12px" th:each="admin:${admins}">
                        <td th:text="${admin.id}">1</td>
    					<td th:text="${admin.username}">13324016592</td>
    					<td th:text="${admin.password}">12345</td>
                        <td th:text="${admin.role}">系统维护人员</td>
    					<td th:text="${#dates.format(admin.addtime, 'yyyy-MM-dd HH:mm')}">2017-7-26 15:42</td>
    					<td th:text="${#dates.format(admin.updatetime, 'yyyy-MM-dd HH:mm')}">2017-7-26 15:42</td>
                        <td th:text="(${admin.enable} == 1) ? '可用' : '冻结'">可用</td>
                        <td th:text="${admin.adder}">skyRuo</td>
    					<td>
                            <div class="am-dropdown" data-am-dropdown="data-am-dropdown">
                                <button class="am-btn am-btn-default am-btn-xs am-dropdown-toggle" data-am-dropdown-toggle="data-am-dropdown-toggle"><span class="am-icon-cog"></span> <span class="am-icon-caret-down"></span></button>
                                <ul class="am-dropdown-content">
                                    <li><a id="a_upadte" th:name="${admin.id}" th:title="${admin.username}" onclick="attrValue(this)" data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0, width: 550, height: 340}">1. 编辑信息</a></li>
                                    <li><a id="a_pot" th:name="${admin.id}" th:title="${admin.username}" onclick="attrValue2(this)" data-am-modal="{target: '#doc-modal-2', closeViaDimmer: 0, width: 550, height: 300}">2. 权限设置</a></li>
                                    <li><a class="del_a" th:title="${admin.id}">3. 删除</a></li>
                                </ul>
                            </div>
    					</td>

  					</tr>
                </tbody>
            </table>
          <p><button type="button" id="add_btn" class="am-btn am-btn-primary" data-am-modal="{target: '#doc-modal-add', closeViaDimmer: 0, width: 450, height: 280}">
              添加管理员
          </button></p>
        </div>
      </div>
    </div>
      <!-- modal of admin update-->
      <div class="am-modal am-modal-no-btn" id="doc-modal-1" style="display: none;">
          <div class="am-modal-dialog">
              <div class="am-modal-hd" ><h3 class="am-form-label">管理员信息修改</h3>
                  <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close="data-am-modal-close">&times;</a>
              </div>
              <div class="am-modal-bd">
                  <form class="am-form am-form-horizontal">
                      <div class="am-form-group">
                          <label for="adminid" class="am-u-sm-3 am-form-label">ID </label>
                          <div class="am-u-sm-9">
                              <input type="text" id="adminid" name="adminid"  readonly="readonly" />
                          </div>
                      </div>

                      <div class="am-form-group">
                          <label for="adminname" class="am-u-sm-3 am-form-label">用户名</label>
                          <div class="am-u-sm-9">
                              <input type="email" id="adminname" name="adminname" readonly="readonly" />
                          </div>
                      </div>

                      <div class="am-form-group">
                          <label for="password" class="am-u-sm-3 am-form-label">密码</label>
                          <div class="am-u-sm-9">
                              <input type="text" id="password" name="password" placeholder="输入修改后的密码" />
                          </div>
                      </div>

                      <div class="am-form-group">
                          <label for="enable" class="am-u-sm-3 am-form-label">是否可用</label>
                          <div class="am-u-sm-9">
                              <input type="text" maxlength="1" pattern="[0-1]*" name="enable" id="enable" placeholder="1代表可用，0代表冻结" />
                          </div>
                      </div>
                      <div class="am-form-group">
                          <div class="am-u-sm-9 am-u-sm-push-3">
                              <button type="button" id="up_btn" class="am-btn am-btn-primary">保存修改</button>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
      </div><!--modal of update admin-->
      <!-- modal of admin pot-->
      <div class="am-modal am-modal-no-btn" id="doc-modal-2" style="display: none;">
          <div class="am-modal-dialog">
              <div class="am-modal-hd" ><h3 class="am-form-label">管理员权限修改</h3>
                  <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close="data-am-modal-close">&times;</a>
              </div>
              <div class="am-modal-bd">
                  <form class="am-form am-form-horizontal">
                      <div class="am-form-group">
                          <label for="adminid2" class="am-u-sm-3 am-form-label">ID </label>
                          <div class="am-u-sm-9">
                              <input type="text" id="adminid2" name="adminid2"  readonly="readonly" />
                          </div>
                      </div>

                      <div class="am-form-group">
                          <label for="adminname2" class="am-u-sm-3 am-form-label">用户名</label>
                          <div class="am-u-sm-9">
                              <input type="email" id="adminname2" name="adminname2" readonly="readonly" />
                          </div>
                      </div>

                      <div class="am-form-group">
                          <label for="admin_role" class="am-u-sm-3 am-form-label">权限角色</label>
                          <div class="am-u-sm-9">
                              <select id="admin_role" name="admin_role" multiple="multiple"  data-am-selected="{dropUp: 1,btnWidth: '100%', btnSize: 'sm'}">
                                  <option th:each="role:${roles}" th:value="${role.id}" th:text="${role.name}">用户管理人员</option>
                              </select>
                          </div>
                      </div>
                      <div class="am-form-group">
                          <div class="am-u-sm-9 am-u-sm-push-3">
                              <button type="button" id="up_admin_pot_btn" class="am-btn am-btn-primary">保存修改</button>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
      </div><!--modal of update pot-->


      <!--modal of add admin-->
      <div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-add">
          <div class="am-modal-dialog">
              <div class="am-modal-hd"><h3 class="am-form-label">添加管理员</h3>
                  <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close="data-am-modal-close">&times;</a>
              </div>
              <div class="am-modal-bd">
                  <form class="am-form am-form-horizontal" data-am-validator="data-am-validator">

                      <div class="am-form-group">
                          <label for="addname" class="am-u-sm-3 am-form-label">用户名</label>
                          <div class="am-u-sm-9">
                              <input type="text" id="addname" name="addname" pattern="^0?1[3|4|5|8][0-9]\d{8}$" placeholder="请输入合法手机号" />
                          </div>
                      </div>
                      <div class="am-form-group">
                          <label for="addpwd" class="am-u-sm-3 am-form-label">密码</label>
                          <div class="am-u-sm-9">
                              <input type="text" id="addpwd" name="addpwd" placeholder="输入登录密码" required="required" />
                          </div>
                      </div>

                      <div class="am-form-group">
                          <label for="addable" class="am-u-sm-3 am-form-label">是否可用</label>
                          <div class="am-u-sm-9">
                              <input type="text" maxlength="1" pattern="[0-1]*" name="addable" id="addable" placeholder="1代表可用，0代表冻结" required="required" />
                          </div>
                      </div>
                      <div class="am-form-group">
                          <div class="am-u-sm-9 am-u-sm-push-3">
                              <button type="button" id="add_admin" class="am-btn am-btn-primary">添加</button>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
      </div><!-- modal of addadmin-->
      <!-- footer -->
    <footer class="admin-content-footer">
      <hr/>
      <p class="am-padding-left">© 2014 AllMobilize, Inc. Licensed under MIT license.</p>
    </footer>
  </div>
  <!-- content end -->

</div>

<a href="#" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu" data-am-offcanvas="{target: '#admin-offcanvas'}"></a>

<footer>
  <hr/>
  <p class="am-padding-left">© 2014 AllMobilize, Inc. Licensed under MIT license.</p>
</footer>

<!--[if lt IE 9]>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="../static/assets/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="../static/assets/js/jquery.min.js"></script>
<!--<![endif]-->
<script th:src="@{/assets/js//jquery-3.2.1.min.js}" src="../static/assets/js/jquery-3.2.1.min.js"></script>
<script th:src="@{/assets/js/amazeui.min.js}" src="../static/assets/js/amazeui.min.js"></script>
<script src="../static/assets/js/app.js"></script>
<script th:src="@{/assets/js/amazeui.datatables.min.js}" src="../static/assets/js/amazeui.datatables.min.js"></script>
<script th:src="@{/js/layer/layer.js}" src="../static/js/layer/layer.js"></script>
<script src="../static/js/updateadmin.js"></script>
<script src="../static/js/addadmin.js"></script>
<script src="../static/js/up_admin_pot.js"></script>
</body>
<script>
    //初始化tadaTable
  $(function() {
    $('#example').DataTable();
  });

  //删除管理
    $(".del_a").on("click",function () {
        var role = $("#admin_role_hidden").val();
        console.log(role);
        if (role == "超级管理员"){
            var adminid = $(this).attr("title");
            layer.confirm('您确定要删除吗？', {
                btn: ['确定','取消'] //按钮
            }, function(){
                var elm={
                    del_id:adminid
                };
                $.ajax({
                    url: "/admin/deladmin",
                    type: "post",
                    dataType: "json",
                    data: elm,
                    success:function(data){
                        layer.closeAll("loading");
                        if (data.msg == "success"){
                            layer.msg('删除成功', {icon: 1});
                            window.setTimeout(function () {//在指定的毫秒数后调用函数
                                window.location.reload();
                            }, 1000);
                        }else {
                            layer.msg("删除失败，请稍后再试",{icon: 5});
                        }
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        layer.closeAll("loading");//关闭动画
                        alert(XMLHttpRequest.responseText);
                        alert(XMLHttpRequest.status);
                        alert(XMLHttpRequest.readyState);
                        alert(textStatus); // parser error;
                    }
                })

            }, function(){
                layer.msg('取消成功', {
                    time: 2000, //20s后自动关闭
                },{icon: 5});
            });
        }else{
            layer.alert("抱歉，您不是超级管理员无权对管理员进行删除操作！");
            return false;
        }

        //layer.load(1);
    })

    //获取id，username显示在模态框
    function attrValue(obj){
        var id=obj.name;
        var username=obj.title;
        console.log("我是"+id);
        document.getElementById("adminid").value=id;
        document.getElementById("adminname").value=username;
    }
    function attrValue2(obj){
        var id=obj.name;
        var username=obj.title;
        console.log("我是"+id);
        document.getElementById("adminid2").value=id;
        document.getElementById("adminname2").value=username;
    }

</script>
</html>
